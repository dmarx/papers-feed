{"version":3,"file":"popup.bundle.js","sources":["../popup.js"],"sourcesContent":["// popup.js\n// Enhanced to support multiple paper sources with new ID format\n\n/**\n * Get paper data from background script\n * @returns {Promise<any>} Paper data or null if not available\n */\nasync function getCurrentPaper() {\n  return new Promise((resolve) => {\n    chrome.runtime.sendMessage({type: 'getCurrentPaper'}, response => {\n      console.log('Got paper data from background:', response);\n      resolve(response);\n    });\n  });\n}\n\n/**\n * Get a formatted label for paper source\n * @param {string} source Paper source identifier\n * @returns {string} Human-readable source label\n */\nfunction getSourceLabel(source) {\n  const labels = {\n    'arxiv': 'arXiv',\n    'semanticscholar': 'Semantic Scholar',\n    'doi': 'DOI',\n    'acm': 'ACM Digital Library',\n    'openreview': 'OpenReview'\n  };\n  return labels[source] || source.charAt(0).toUpperCase() + source.slice(1);\n}\n\n/**\n * Update UI with paper data\n * @param {Object} paperData Paper metadata\n */\nfunction updateUI(paperData) {\n  const titleElement = document.getElementById('paperTitle');\n  const authorsElement = document.getElementById('paperAuthors');\n  const statusElement = document.getElementById('status');\n  const sourceElement = document.getElementById('paperSource');\n\n  if (paperData) {\n    // Validate the data has primary_id (shouldn't happen but we check anyway)\n    if (!paperData.primary_id) {\n      console.warn('Paper data missing primary_id:', paperData);\n      if (paperData.source && paperData.sourceId) {\n        // Build primary_id from components\n        paperData.primary_id = formatPrimaryId(paperData.source, paperData.sourceId);\n      } else if (paperData.arxivId) {\n        // Legacy fallback\n        paperData.source = 'arxiv';\n        paperData.sourceId = paperData.arxivId;\n        paperData.primary_id = formatPrimaryId('arxiv', paperData.arxivId);\n      }\n    }\n    \n    // Set paper details\n    titleElement.textContent = paperData.title || paperData.sourceId || 'Untitled Paper';\n    authorsElement.textContent = paperData.authors || '';\n    \n    // Set source information\n    if (paperData.source) {\n      sourceElement.textContent = getSourceLabel(paperData.source);\n      sourceElement.classList.remove('hidden');\n      \n      // Add source-specific class for styling\n      sourceElement.className = 'paper-source';\n      sourceElement.classList.add(`source-${paperData.source}`);\n    } else {\n      sourceElement.classList.add('hidden');\n    }\n    \n    statusElement.textContent = 'Paper tracked! Data stored on GitHub.';\n    \n    // Enable rating buttons\n    document.getElementById('thumbsUp').disabled = false;\n    document.getElementById('thumbsDown').disabled = false;\n    \n    // Highlight active rating if set\n    if (paperData.rating === 'thumbsup') {\n      document.getElementById('thumbsUp').classList.add('active');\n    } else if (paperData.rating === 'thumbsdown') {\n      document.getElementById('thumbsDown').classList.add('active');\n    }\n  } else {\n    titleElement.textContent = 'No academic paper detected';\n    authorsElement.textContent = '';\n    sourceElement.classList.add('hidden');\n    statusElement.textContent = 'Visit a supported academic paper to track it';\n    \n    // Disable rating buttons\n    document.getElementById('thumbsUp').disabled = true;\n    document.getElementById('thumbsDown').disabled = true;\n  }\n}\n\n/**\n * Format a source-specific ID into a universal primary ID format\n * @param {string} source Source type (e.g. 'arxiv', 'doi')\n * @param {string} id Original source-specific identifier\n * @returns {string} Formatted primary ID\n */\nfunction formatPrimaryId(source, id) {\n  // Source prefixes match the ones in source_utils.ts\n  const prefixes = {\n    'arxiv': 'arxiv',\n    'semanticscholar': 's2',\n    'doi': 'doi',\n    'acm': 'doi',  // ACM also uses DOIs\n    'openreview': 'openreview',\n    'default': 'generic'\n  };\n  \n  // Use source-specific prefixes\n  const sourcePrefix = prefixes[source] || prefixes.default;\n  \n  // Sanitize the ID by replacing problematic characters\n  const safeId = id\n    .replace(/\\//g, '_')\n    .replace(/:/g, '.')\n    .replace(/\\s/g, '_')\n    .replace(/\\\\/g, '_');\n  \n  return `${sourcePrefix}.${safeId}`;\n}\n\n/**\n * Check if URL is a supported paper source\n * @param {string} url URL to check\n * @returns {boolean} Whether URL is from a supported source\n */\nfunction isPaperUrl(url) {\n  // Check all supported sources\n  return (\n    url.includes('arxiv.org/') ||\n    url.includes('semanticscholar.org/paper/') ||\n    url.includes('doi.org/') ||\n    url.includes('dl.acm.org/doi/') ||\n    url.includes('openreview.net/forum')\n  );\n}\n\n// Initialize popup\ndocument.addEventListener('DOMContentLoaded', async () => {\n  console.log('Popup opened');\n  \n  // Get current tab\n  const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });\n  console.log('Current tab:', tab.url);\n  \n  if (isPaperUrl(tab.url)) {\n    console.log('On academic paper page, getting paper data...');\n    \n    // Try multiple times to get paper data, as it might not be ready immediately\n    let retries = 3;\n    let paperData = null;\n    \n    while (retries > 0 && !paperData) {\n      paperData = await getCurrentPaper();\n      if (!paperData) {\n        await new Promise(resolve => setTimeout(resolve, 500)); // Wait 500ms before retry\n        retries--;\n      }\n    }\n    \n    updateUI(paperData);\n    \n    // Set up rating handlers\n    document.getElementById('thumbsUp').addEventListener('click', () => {\n      chrome.runtime.sendMessage({\n        type: 'updateRating',\n        rating: 'thumbsup'\n      }, response => {\n        if (response && response.success) {\n          document.getElementById('status').textContent = 'Rating updated to: thumbs up';\n          document.getElementById('thumbsUp').classList.add('active');\n          document.getElementById('thumbsDown').classList.remove('active');\n          setTimeout(() => window.close(), 1500);\n        } else if (response && response.error) {\n          document.getElementById('status').textContent = `Error: ${response.error}`;\n        }\n      });\n    });\n    \n    document.getElementById('thumbsDown').addEventListener('click', () => {\n      chrome.runtime.sendMessage({\n        type: 'updateRating',\n        rating: 'thumbsdown'\n      }, response => {\n        if (response && response.success) {\n          document.getElementById('status').textContent = 'Rating updated to: thumbs down';\n          document.getElementById('thumbsUp').classList.remove('active');\n          document.getElementById('thumbsDown').classList.add('active');\n          setTimeout(() => window.close(), 1500);\n        } else if (response && response.error) {\n          document.getElementById('status').textContent = `Error: ${response.error}`;\n        }\n      });\n    });\n  } else {\n    updateUI(null);\n  }\n});\n"],"names":[],"mappings":"AAOA,eAAe,eAAkB,GAAA;AAC/B,EAAO,OAAA,IAAI,OAAQ,CAAA,CAAC,OAAY,KAAA;AAC9B,IAAA,MAAA,CAAO,QAAQ,WAAY,CAAA,EAAC,IAAM,EAAA,iBAAA,IAAoB,CAAY,QAAA,KAAA;AAChE,MAAQ,OAAA,CAAA,GAAA,CAAI,mCAAmC,QAAQ,CAAA;AACvD,MAAA,OAAA,CAAQ,QAAQ,CAAA;AAAA,KACjB,CAAA;AAAA,GACF,CAAA;AACH;AAOA,SAAS,eAAe,MAAQ,EAAA;AAC9B,EAAA,MAAM,MAAS,GAAA;AAAA,IACb,OAAS,EAAA,OAAA;AAAA,IACT,iBAAmB,EAAA,kBAAA;AAAA,IACnB,KAAO,EAAA,KAAA;AAAA,IACP,KAAO,EAAA,qBAAA;AAAA,IACP,YAAc,EAAA;AAAA,GAChB;AACA,EAAO,OAAA,MAAA,CAAO,MAAM,CAAA,IAAK,MAAO,CAAA,MAAA,CAAO,CAAC,CAAA,CAAE,WAAY,EAAA,GAAI,MAAO,CAAA,KAAA,CAAM,CAAC,CAAA;AAC1E;AAMA,SAAS,SAAS,SAAW,EAAA;AAC3B,EAAM,MAAA,YAAA,GAAe,QAAS,CAAA,cAAA,CAAe,YAAY,CAAA;AACzD,EAAM,MAAA,cAAA,GAAiB,QAAS,CAAA,cAAA,CAAe,cAAc,CAAA;AAC7D,EAAM,MAAA,aAAA,GAAgB,QAAS,CAAA,cAAA,CAAe,QAAQ,CAAA;AACtD,EAAM,MAAA,aAAA,GAAgB,QAAS,CAAA,cAAA,CAAe,aAAa,CAAA;AAE3D,EAAA,IAAI,SAAW,EAAA;AAEb,IAAI,IAAA,CAAC,UAAU,UAAY,EAAA;AACzB,MAAQ,OAAA,CAAA,IAAA,CAAK,kCAAkC,SAAS,CAAA;AACxD,MAAI,IAAA,SAAA,CAAU,MAAU,IAAA,SAAA,CAAU,QAAU,EAAA;AAE1C,QAAA,SAAA,CAAU,UAAa,GAAA,eAAA,CAAgB,SAAU,CAAA,MAAA,EAAQ,UAAU,QAAQ,CAAA;AAAA,OAC7E,MAAA,IAAW,UAAU,OAAS,EAAA;AAE5B,QAAA,SAAA,CAAU,MAAS,GAAA,OAAA;AACnB,QAAA,SAAA,CAAU,WAAW,SAAU,CAAA,OAAA;AAC/B,QAAA,SAAA,CAAU,UAAa,GAAA,eAAA,CAAgB,OAAS,EAAA,SAAA,CAAU,OAAO,CAAA;AAAA;AACnE;AAIF,IAAA,YAAA,CAAa,WAAc,GAAA,SAAA,CAAU,KAAS,IAAA,SAAA,CAAU,QAAY,IAAA,gBAAA;AACpE,IAAe,cAAA,CAAA,WAAA,GAAc,UAAU,OAAW,IAAA,EAAA;AAGlD,IAAA,IAAI,UAAU,MAAQ,EAAA;AACpB,MAAc,aAAA,CAAA,WAAA,GAAc,cAAe,CAAA,SAAA,CAAU,MAAM,CAAA;AAC3D,MAAc,aAAA,CAAA,SAAA,CAAU,OAAO,QAAQ,CAAA;AAGvC,MAAA,aAAA,CAAc,SAAY,GAAA,cAAA;AAC1B,MAAA,aAAA,CAAc,SAAU,CAAA,GAAA,CAAI,CAAU,OAAA,EAAA,SAAA,CAAU,MAAM,CAAE,CAAA,CAAA;AAAA,KACnD,MAAA;AACL,MAAc,aAAA,CAAA,SAAA,CAAU,IAAI,QAAQ,CAAA;AAAA;AAGtC,IAAA,aAAA,CAAc,WAAc,GAAA,uCAAA;AAG5B,IAAS,QAAA,CAAA,cAAA,CAAe,UAAU,CAAA,CAAE,QAAW,GAAA,KAAA;AAC/C,IAAS,QAAA,CAAA,cAAA,CAAe,YAAY,CAAA,CAAE,QAAW,GAAA,KAAA;AAGjD,IAAI,IAAA,SAAA,CAAU,WAAW,UAAY,EAAA;AACnC,MAAA,QAAA,CAAS,cAAe,CAAA,UAAU,CAAE,CAAA,SAAA,CAAU,IAAI,QAAQ,CAAA;AAAA,KAC5D,MAAA,IAAW,SAAU,CAAA,MAAA,KAAW,YAAc,EAAA;AAC5C,MAAA,QAAA,CAAS,cAAe,CAAA,YAAY,CAAE,CAAA,SAAA,CAAU,IAAI,QAAQ,CAAA;AAAA;AAC9D,GACK,MAAA;AACL,IAAA,YAAA,CAAa,WAAc,GAAA,4BAAA;AAC3B,IAAA,cAAA,CAAe,WAAc,GAAA,EAAA;AAC7B,IAAc,aAAA,CAAA,SAAA,CAAU,IAAI,QAAQ,CAAA;AACpC,IAAA,aAAA,CAAc,WAAc,GAAA,8CAAA;AAG5B,IAAS,QAAA,CAAA,cAAA,CAAe,UAAU,CAAA,CAAE,QAAW,GAAA,IAAA;AAC/C,IAAS,QAAA,CAAA,cAAA,CAAe,YAAY,CAAA,CAAE,QAAW,GAAA,IAAA;AAAA;AAErD;AAQA,SAAS,eAAA,CAAgB,QAAQ,EAAI,EAAA;AAEnC,EAAA,MAAM,QAAW,GAAA;AAAA,IACf,OAAS,EAAA,OAAA;AAAA,IACT,iBAAmB,EAAA,IAAA;AAAA,IACnB,KAAO,EAAA,KAAA;AAAA,IACP,KAAO,EAAA,KAAA;AAAA;AAAA,IACP,YAAc,EAAA,YAAA;AAAA,IACd,SAAW,EAAA;AAAA,GACb;AAGA,EAAA,MAAM,YAAe,GAAA,QAAA,CAAS,MAAM,CAAA,IAAK,QAAS,CAAA,OAAA;AAGlD,EAAA,MAAM,SAAS,EACZ,CAAA,OAAA,CAAQ,KAAO,EAAA,GAAG,EAClB,OAAQ,CAAA,IAAA,EAAM,GAAG,CAAA,CACjB,QAAQ,KAAO,EAAA,GAAG,CAClB,CAAA,OAAA,CAAQ,OAAO,GAAG,CAAA;AAErB,EAAO,OAAA,CAAA,EAAG,YAAY,CAAA,CAAA,EAAI,MAAM,CAAA,CAAA;AAClC;AAOA,SAAS,WAAW,GAAK,EAAA;AAEvB,EAAA,OACE,IAAI,QAAS,CAAA,YAAY,KACzB,GAAI,CAAA,QAAA,CAAS,4BAA4B,CACzC,IAAA,GAAA,CAAI,QAAS,CAAA,UAAU,KACvB,GAAI,CAAA,QAAA,CAAS,iBAAiB,CAC9B,IAAA,GAAA,CAAI,SAAS,sBAAsB,CAAA;AAEvC;AAGA,QAAS,CAAA,gBAAA,CAAiB,oBAAoB,YAAY;AACxD,EAAA,OAAA,CAAQ,IAAI,cAAc,CAAA;AAG1B,EAAA,MAAM,CAAC,GAAG,CAAI,GAAA,MAAM,MAAO,CAAA,IAAA,CAAK,KAAM,CAAA,EAAE,MAAQ,EAAA,IAAA,EAAM,aAAe,EAAA,IAAA,EAAM,CAAA;AAC3E,EAAQ,OAAA,CAAA,GAAA,CAAI,cAAgB,EAAA,GAAA,CAAI,GAAG,CAAA;AAEnC,EAAI,IAAA,UAAA,CAAW,GAAI,CAAA,GAAG,CAAG,EAAA;AACvB,IAAA,OAAA,CAAQ,IAAI,+CAA+C,CAAA;AAG3D,IAAA,IAAI,OAAU,GAAA,CAAA;AACd,IAAA,IAAI,SAAY,GAAA,IAAA;AAEhB,IAAO,OAAA,OAAA,GAAU,CAAK,IAAA,CAAC,SAAW,EAAA;AAChC,MAAA,SAAA,GAAY,MAAM,eAAgB,EAAA;AAClC,MAAA,IAAI,CAAC,SAAW,EAAA;AACd,QAAA,MAAM,IAAI,OAAQ,CAAA,CAAA,OAAA,KAAW,UAAW,CAAA,OAAA,EAAS,GAAG,CAAC,CAAA;AACrD,QAAA,OAAA,EAAA;AAAA;AACF;AAGF,IAAA,QAAA,CAAS,SAAS,CAAA;AAGlB,IAAA,QAAA,CAAS,cAAe,CAAA,UAAU,CAAE,CAAA,gBAAA,CAAiB,SAAS,MAAM;AAClE,MAAA,MAAA,CAAO,QAAQ,WAAY,CAAA;AAAA,QACzB,IAAM,EAAA,cAAA;AAAA,QACN,MAAQ,EAAA;AAAA,SACP,CAAY,QAAA,KAAA;AACb,QAAI,IAAA,QAAA,IAAY,SAAS,OAAS,EAAA;AAChC,UAAS,QAAA,CAAA,cAAA,CAAe,QAAQ,CAAA,CAAE,WAAc,GAAA,8BAAA;AAChD,UAAA,QAAA,CAAS,cAAe,CAAA,UAAU,CAAE,CAAA,SAAA,CAAU,IAAI,QAAQ,CAAA;AAC1D,UAAA,QAAA,CAAS,cAAe,CAAA,YAAY,CAAE,CAAA,SAAA,CAAU,OAAO,QAAQ,CAAA;AAC/D,UAAA,UAAA,CAAW,MAAM,IAAA,CAAO,KAAM,EAAA,EAAG,IAAI,CAAA;AAAA,SACvC,MAAA,IAAW,QAAY,IAAA,QAAA,CAAS,KAAO,EAAA;AACrC,UAAA,QAAA,CAAS,eAAe,QAAQ,CAAA,CAAE,WAAc,GAAA,CAAA,OAAA,EAAU,SAAS,KAAK,CAAA,CAAA;AAAA;AAC1E,OACD,CAAA;AAAA,KACF,CAAA;AAED,IAAA,QAAA,CAAS,cAAe,CAAA,YAAY,CAAE,CAAA,gBAAA,CAAiB,SAAS,MAAM;AACpE,MAAA,MAAA,CAAO,QAAQ,WAAY,CAAA;AAAA,QACzB,IAAM,EAAA,cAAA;AAAA,QACN,MAAQ,EAAA;AAAA,SACP,CAAY,QAAA,KAAA;AACb,QAAI,IAAA,QAAA,IAAY,SAAS,OAAS,EAAA;AAChC,UAAS,QAAA,CAAA,cAAA,CAAe,QAAQ,CAAA,CAAE,WAAc,GAAA,gCAAA;AAChD,UAAA,QAAA,CAAS,cAAe,CAAA,UAAU,CAAE,CAAA,SAAA,CAAU,OAAO,QAAQ,CAAA;AAC7D,UAAA,QAAA,CAAS,cAAe,CAAA,YAAY,CAAE,CAAA,SAAA,CAAU,IAAI,QAAQ,CAAA;AAC5D,UAAA,UAAA,CAAW,MAAM,IAAA,CAAO,KAAM,EAAA,EAAG,IAAI,CAAA;AAAA,SACvC,MAAA,IAAW,QAAY,IAAA,QAAA,CAAS,KAAO,EAAA;AACrC,UAAA,QAAA,CAAS,eAAe,QAAQ,CAAA,CAAE,WAAc,GAAA,CAAA,OAAA,EAAU,SAAS,KAAK,CAAA,CAAA;AAAA;AAC1E,OACD,CAAA;AAAA,KACF,CAAA;AAAA,GACI,MAAA;AACL,IAAA,QAAA,CAAS,IAAI,CAAA;AAAA;AAEjB,CAAC,CAAA"}