{"version":3,"file":"popup.bundle.js","sources":["../../popup.ts"],"sourcesContent":["// popup.ts\n// TypeScript conversion of popup.js\n\nconsole.log('Popup script starting...');\n\nimport { PaperMetadata } from './papers/types';\n\n// Function to get paper data from background script\nasync function getCurrentPaper(): Promise<PaperMetadata | null> {\n  return new Promise((resolve) => {\n    chrome.runtime.sendMessage({type: 'getCurrentPaper'}, (response) => {\n      console.log('Got paper data from background:', response);\n      resolve(response as PaperMetadata | null);\n    });\n  });\n}\n\n// Interface for page metadata\ninterface PageMetadata {\n  url: string;\n  title: string;\n  authors: string;\n  description: string;\n  publishedDate: string;\n  // new fields, may cause issues downstream\n  doi?: string;\n  journalName?: string;\n  tags?: string[];\n}\n\n// Function to extract metadata from the page with support for Dublin Core and Citation metadata\n// TODO: move this to generic or base source-integration\nfunction extractPageMetadata(): Partial<PageMetadata> {\n  const metadata: Partial<PageMetadata> = {\n    title: '',\n    authors: '',\n    description: '',\n    publishedDate: '',\n    doi: '',\n    journalName: '',\n    tags: []\n  };\n\n  // Helper function to get content from meta tags\n  const getMetaContent = (selector: string): string => {\n    const element = document.querySelector(selector);\n    return element ? element.getAttribute('content') || '' : '';\n  };\n\n  // Title extraction - priority order\n  metadata.title = \n    // Dublin Core\n    getMetaContent('meta[name=\"DC.Title\"]') ||\n    // Citation\n    getMetaContent('meta[name=\"citation_title\"]') ||\n    // Open Graph\n    getMetaContent('meta[property=\"og:title\"]') ||\n    // Standard meta\n    getMetaContent('meta[name=\"title\"]') ||\n    // Fallback to document title\n    document.title;\n\n  // Author extraction - multiple possibilities and potentially multiple authors\n  const dcCreator = getMetaContent('meta[name=\"DC.Creator.PersonalName\"]');\n  const citationAuthor = getMetaContent('meta[name=\"citation_author\"]');\n  const ogAuthor = getMetaContent('meta[property=\"og:article:author\"]') || \n                  getMetaContent('meta[name=\"author\"]');\n  \n  // Get all citation authors (some pages have multiple citation_author tags)\n  const citationAuthors: string[] = [];\n  document.querySelectorAll('meta[name=\"citation_author\"]').forEach(el => {\n    const content = el.getAttribute('content');\n    if (content) citationAuthors.push(content);\n  });\n  \n  // Get all DC creators\n  const dcCreators: string[] = [];\n  document.querySelectorAll('meta[name=\"DC.Creator.PersonalName\"]').forEach(el => {\n    const content = el.getAttribute('content');\n    if (content) dcCreators.push(content);\n  });\n  \n  // Set authors with priority\n  if (dcCreators.length > 0) {\n    metadata.authors = dcCreators.join(', ');\n  } else if (citationAuthors.length > 0) {\n    metadata.authors = citationAuthors.join(', ');\n  } else if (dcCreator) {\n    metadata.authors = dcCreator;\n  } else if (citationAuthor) {\n    metadata.authors = citationAuthor;\n  } else if (ogAuthor) {\n    metadata.authors = ogAuthor;\n  }\n\n  // Description/Abstract extraction\n  metadata.description = \n    getMetaContent('meta[name=\"DC.Description\"]') ||\n    getMetaContent('meta[name=\"citation_abstract\"]') ||\n    getMetaContent('meta[property=\"og:description\"]') || \n    getMetaContent('meta[name=\"description\"]');\n\n  // Publication date extraction\n  metadata.publishedDate = \n    getMetaContent('meta[name=\"DC.Date.issued\"]') ||\n    getMetaContent('meta[name=\"citation_date\"]') ||\n    getMetaContent('meta[property=\"article:published_time\"]');\n\n  // DOI extraction\n  metadata.doi = \n    getMetaContent('meta[name=\"DC.Identifier.DOI\"]') ||\n    getMetaContent('meta[name=\"citation_doi\"]');\n\n  // Journal name extraction\n  metadata.journalName = \n    getMetaContent('meta[name=\"DC.Source\"]') ||\n    getMetaContent('meta[name=\"citation_journal_title\"]');\n\n  // Extract keywords/tags if available\n  const keywords = getMetaContent('meta[name=\"keywords\"]') || \n                  getMetaContent('meta[name=\"DC.Subject\"]');\n  \n  if (keywords) {\n    metadata.tags = keywords.split(',').map(tag => tag.trim());\n  }\n\n  console.log('Extracted metadata:', metadata);\n  return metadata;\n}\n\n// Function to get current tab info and metadata\nasync function getCurrentTabInfo(): Promise<PageMetadata> {\n  return new Promise((resolve) => {\n    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\n      if (tabs[0] && tabs[0].id) {\n        // Execute script to extract metadata from page\n        chrome.scripting.executeScript({\n          target: { tabId: tabs[0].id },\n          func: extractPageMetadata\n        }, (results) => {\n          if (results && results[0] && results[0].result) {\n            resolve({\n              url: tabs[0].url || '',\n              title: tabs[0].title || '',\n              ...results[0].result as Partial<PageMetadata>\n            } as PageMetadata);\n          } else {\n            resolve({\n              url: tabs[0].url || '',\n              title: tabs[0].title || '',\n              authors: '',\n              description: '',\n              publishedDate: ''\n            });\n          }\n        });\n      } else {\n        resolve({ \n          url: '', \n          title: '', \n          authors: '', \n          description: '',\n          publishedDate: '' \n        });\n      }\n    });\n  });\n}\n\n// Generate a paper ID from a URL\nfunction generatePaperIdFromUrl(url: string): string {\n  // Use a basic hash function to create an ID from the URL\n  let hash = 0;\n  for (let i = 0; i < url.length; i++) {\n    const char = url.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n  \n  // Create a positive hexadecimal string\n  const positiveHash = Math.abs(hash).toString(16).toUpperCase();\n  \n  // sourceType will get prepended elsewhere, this is just generating a \n  // \"source-specific\" `paperId`, not the system-internal `objectId`\n  return `${positiveHash.substring(0, 8)}`;\n}\n\n// Function to update UI with paper data\nfunction updateUI(paperData: PaperMetadata | null): void {\n  const titleElement = document.getElementById('paperTitle');\n  const authorsElement = document.getElementById('paperAuthors');\n  const statusElement = document.getElementById('status');\n  const manualLogSection = document.getElementById('manualLogSection');\n\n  if (!titleElement || !authorsElement || !statusElement || !manualLogSection) {\n    console.error('Required DOM elements not found');\n    return;\n  }\n\n  if (paperData) {\n    // Show detected paper data\n    titleElement.textContent = paperData.title || paperData.paperId;\n    authorsElement.textContent = paperData.authors;\n    statusElement.textContent = 'Paper tracked! Issue created on GitHub.';\n    \n    // Enable rating buttons\n    const thumbsUpButton = document.getElementById('thumbsUp') as HTMLButtonElement;\n    const thumbsDownButton = document.getElementById('thumbsDown') as HTMLButtonElement;\n    \n    if (thumbsUpButton && thumbsDownButton) {\n      thumbsUpButton.disabled = false;\n      thumbsDownButton.disabled = false;\n      \n      // Set active state on rating buttons\n      thumbsUpButton.classList.toggle('active', paperData.rating === 'thumbsup');\n      thumbsDownButton.classList.toggle('active', paperData.rating === 'thumbsdown');\n    }\n    \n    // Hide manual log section\n    manualLogSection.style.display = 'none';\n  } else {\n    // No paper detected - show manual log option\n    titleElement.textContent = 'No paper detected';\n    authorsElement.textContent = '';\n    statusElement.textContent = 'Current page not recognized as a paper';\n    \n    // Disable rating buttons\n    const thumbsUpButton = document.getElementById('thumbsUp') as HTMLButtonElement;\n    const thumbsDownButton = document.getElementById('thumbsDown') as HTMLButtonElement;\n    \n    if (thumbsUpButton && thumbsDownButton) {\n      thumbsUpButton.disabled = true;\n      thumbsDownButton.disabled = true;\n    }\n    \n    // Show manual log section\n    manualLogSection.style.display = 'block';\n  }\n}\n\n// Interface for message response\ninterface MessageResponse {\n  success: boolean;\n  error?: string;\n}\n\n// Function to log current page as a paper (one-click experience)\nasync function logCurrentPage(pageInfo: PageMetadata): Promise<void> {\n  console.log(\"attempting to log paper\");\n  // Generate a paper ID from the URL\n  const paperId = generatePaperIdFromUrl(pageInfo.url);\n  console.log(\"generated paperId:\", paperId);\n  \n  // Use 'pdf' or 'url' as the source identifier\n  const sourceId = pageInfo.url.toLowerCase().endsWith('.pdf') ? 'pdf' : 'url';\n  \n  // Create paper metadata with extracted info\n  const metadata: PaperMetadata = {\n    sourceId: sourceId,\n    paperId: paperId,\n    url: pageInfo.url,\n    title: pageInfo.title || paperId,\n    authors: pageInfo.authors || '',\n    abstract: pageInfo.description || '',\n    timestamp: new Date().toISOString(),\n    publishedDate: pageInfo.publishedDate || '',\n    tags: [],\n    rating: 'novote'\n  };\n\n  console.log(\"PaperMetadata:\", metadata);\n  \n  // Send to background script\n  chrome.runtime.sendMessage({\n    type: 'manualPaperLog',\n    metadata: metadata\n  }, (response: MessageResponse) => {\n    const statusElement = document.getElementById('status');\n    if (!statusElement) return;\n\n    if (response && response.success) {\n      statusElement.textContent = 'Page tracked successfully!';\n      \n      // Update UI to show the logged paper\n      updateUI(metadata);\n      \n      // Start a session for this paper\n      chrome.runtime.sendMessage({\n        type: 'startSession',\n        sourceId: sourceId,\n        paperId: paperId\n      });\n      \n      // Enable rating buttons\n      const thumbsUpButton = document.getElementById('thumbsUp') as HTMLButtonElement;\n      const thumbsDownButton = document.getElementById('thumbsDown') as HTMLButtonElement;\n      \n      if (thumbsUpButton && thumbsDownButton) {\n        thumbsUpButton.disabled = false;\n        thumbsDownButton.disabled = false;\n      }\n      \n      // Hide manual log section\n      const manualLogSection = document.getElementById('manualLogSection');\n      if (manualLogSection) {\n        manualLogSection.style.display = 'none';\n      }\n    } else {\n      statusElement.textContent = 'Error: ' + (response?.error || 'Failed to log paper');\n    }\n  });\n}\n\n// Initialize popup\ndocument.addEventListener('DOMContentLoaded', async () => {\n  console.log('Popup opened');\n  \n  // Get current tab info with metadata\n  const tabInfo = await getCurrentTabInfo();\n  console.log('Current tab:', tabInfo);\n  \n  // Get paper from the session tracker\n  let paperData: PaperMetadata | null = null;\n  let retries = 3;\n  \n  while (retries > 0 && !paperData) {\n    paperData = await getCurrentPaper();\n    if (!paperData) {\n      await new Promise(resolve => setTimeout(resolve, 500)); // Wait 500ms before retry\n      retries--;\n    }\n  }\n  \n  updateUI(paperData);\n  \n  // Set up rating handlers\n  const thumbsUpButton = document.getElementById('thumbsUp');\n  if (thumbsUpButton) {\n    thumbsUpButton.addEventListener('click', () => {\n      chrome.runtime.sendMessage({\n        type: 'updateRating',\n        rating: 'thumbsup'\n      }, (response: MessageResponse) => {\n        const statusElement = document.getElementById('status');\n        const thumbsUpButton = document.getElementById('thumbsUp');\n        const thumbsDownButton = document.getElementById('thumbsDown');\n        \n        if (!statusElement || !thumbsUpButton || !thumbsDownButton) return;\n        \n        if (response && response.success) {\n          statusElement.textContent = 'Rating updated to: thumbs up';\n          thumbsUpButton.classList.add('active');\n          thumbsDownButton.classList.remove('active');\n          setTimeout(() => window.close(), 1500);\n        } else {\n          statusElement.textContent = 'Error: ' + (response?.error || 'Unknown error');\n        }\n      });\n    });\n  }\n  \n  const thumbsDownButton = document.getElementById('thumbsDown');\n  if (thumbsDownButton) {\n    thumbsDownButton.addEventListener('click', () => {\n      chrome.runtime.sendMessage({\n        type: 'updateRating',\n        rating: 'thumbsdown'\n      }, (response: MessageResponse) => {\n        const statusElement = document.getElementById('status');\n        const thumbsUpButton = document.getElementById('thumbsUp');\n        const thumbsDownButton = document.getElementById('thumbsDown');\n        \n        if (!statusElement || !thumbsUpButton || !thumbsDownButton) return;\n        \n        if (response && response.success) {\n          statusElement.textContent = 'Rating updated to: thumbs down';\n          thumbsDownButton.classList.add('active');\n          thumbsUpButton.classList.remove('active');\n          setTimeout(() => window.close(), 1500);\n        } else {\n          statusElement.textContent = 'Error: ' + (response?.error || 'Unknown error');\n        }\n      });\n    });\n  }\n  \n  // Set up one-click logging button\n  const logPageButton = document.getElementById('logPageButton');\n  if (logPageButton) {\n    console.log(\"Attaching logPageButton event listener...\");\n    logPageButton.addEventListener('click', () => {\n      console.log(\"logPageButton clicked...\");\n      logCurrentPage(tabInfo);\n    });\n  }\n});\n"],"names":[],"mappings":"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"}